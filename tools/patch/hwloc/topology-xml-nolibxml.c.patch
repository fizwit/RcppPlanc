Subject: [PATCH] topology-xml-nolibxml.c.patch
---
Index: hwloc/topology-xml-nolibxml.c
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/hwloc/topology-xml-nolibxml.c b/hwloc/topology-xml-nolibxml.c
--- a/hwloc/topology-xml-nolibxml.c	(revision f262ce42ff5a007a8f247b546a6fc322b2922d1e)
+++ b/hwloc/topology-xml-nolibxml.c	(date 1699467927529)
@@ -326,9 +326,9 @@
 {
   hwloc_nolibxml_free_buffers(bdata);
 
-  if (result < 0 && hwloc__xml_verbose())
-    fprintf(stderr, "Failed to parse XML input with the minimalistic parser. If it was not\n"
-	    "generated by hwloc, try enabling full XML support with libxml2.\n");
+  // if (result < 0 && hwloc__xml_verbose())
+    // fprintf(stderr, "Failed to parse XML input with the minimalistic parser. If it was not\n"
+	//    "generated by hwloc, try enabling full XML support with libxml2.\n");
 }
 
 /********************
@@ -749,7 +749,8 @@
     return -1;
 
   if (!strcmp(filename, "-")) {
-    file = stdout;
+      free(buffer);
+      return -1;
   } else {
     file = fopen(filename, "w");
     if (!file) {
@@ -768,8 +769,8 @@
 
   free(buffer);
 
-  if (file != stdout)
-    fclose(file);
+
+  fclose(file);
   return ret;
 }
 
@@ -849,7 +850,8 @@
     return -1;
 
   if (!strcmp(filename, "-")) {
-    file = stdout;
+      free(buffer);
+      return -1;
   } else {
     file = fopen(filename, "w");
     if (!file) {
@@ -868,8 +870,8 @@
 
   free(buffer);
 
-  if (file != stdout)
-    fclose(file);
+
+  fclose(file);
   return ret;
 }
 
